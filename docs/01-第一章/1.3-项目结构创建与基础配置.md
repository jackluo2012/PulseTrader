# 1.3 é¡¹ç›®ç»“æ„åˆ›å»ºä¸åŸºç¡€é…ç½®

## ğŸ“‹ å­¦ä¹ ç›®æ ‡
- åˆ›å»ºæ ‡å‡†åŒ–çš„é¡¹ç›®ç›®å½•ç»“æ„
- é…ç½®é¡¹ç›®çš„åŸºç¡€è®¾ç½®æ–‡ä»¶
- è®¾ç½®ç¯å¢ƒå˜é‡å’Œé…ç½®ç®¡ç†
- å»ºç«‹ç‰ˆæœ¬æ§åˆ¶å’Œä»£ç è§„èŒƒ

## â±ï¸ é¢„è®¡å®Œæˆæ—¶é—´
15-20åˆ†é’Ÿ

---

## æ­¥éª¤1ï¼šåˆ›å»ºå®Œæ•´é¡¹ç›®ç›®å½•ç»“æ„

```bash
# éªŒè¯å½“å‰ç›®å½•ç»“æ„
pwd  # åº”è¯¥åœ¨ /home/jackluo/data/PulseTrader

# åˆ›å»ºå®Œæ•´çš„é¡¹ç›®ç›®å½•ç»“æ„
mkdir -p src/{data,strategies,backtest,execution,utils}
mkdir -p tests/{unit,integration,fixtures}
mkdir -p notebooks/{data_analysis,strategy_research,backtesting}
mkdir -p scripts/{database,data_download,monitoring}
mkdir -p config/{clickhouse,logging,app}
mkdir -p docs/{api,user_guide,development}
mkdir -p data/{raw/{daily,intraday,fundamentals},processed,logs/{app,database,system},cache}
mkdir -p rust/{src/{indicators,risk,performance},python/pulse_trader_rust,benches,tests}
mkdir -p deployment/{docker,kubernetes,monitoring}

# åˆ›å»ºæ‰€æœ‰å¿…è¦çš„__init__.pyæ–‡ä»¶
touch src/__init__.py
touch src/data/__init__.py
touch src/strategies/__init__.py
touch src/backtest/__init__.py
touch src/execution/__init__.py
touch src/utils/__init__.py
touch tests/__init__.py
touch tests/unit/__init__.py
touch tests/integration/__init__.py
touch tests/fixtures/__init__.py
touch rust/python/pulse_trader_rust/__init__.py

# åˆ›å»ºå ä½æ–‡ä»¶ä¿æŒç›®å½•ç»“æ„
touch data/raw/daily/.gitkeep
touch data/raw/intraday/.gitkeep
touch data/raw/fundamentals/.gitkeep
touch data/processed/.gitkeep
touch data/logs/app/.gitkeep
touch data/logs/database/.gitkeep
touch data/logs/system/.gitkeep
touch data/cache/.gitkeep

# éªŒè¯åˆ›å»ºçš„ç›®å½•ç»“æ„
tree -L 3 -I '.git|__pycache__|*.pyc'
```

## æ­¥éª¤2ï¼šé…ç½®é¡¹ç›®åŸºç¡€æ–‡ä»¶

### 2.1 åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ¨¡æ¿
cat > .env.example << 'EOF'
# æ•°æ®åº“é…ç½®
CLICKHOUSE_HOST=localhost
CLICKHOUSE_PORT=8123
CLICKHOUSE_USER=quant_user
CLICKHOUSE_PASSWORD=Quant@2024
CLICKHOUSE_DATABASE=pulse_trader

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# åº”ç”¨é…ç½®
APP_ENV=development
DEBUG=True
LOG_LEVEL=INFO

# æ•°æ®æºé…ç½®
AKSHARE_TIMEOUT=30
AKSHARE_RETRY=3

# äº¤æ˜“é…ç½®
DEFAULT_CAPITAL=1000000.0
MAX_POSITION_SIZE=0.1
COMMISSION_RATE=0.0003
EOF

# åˆ›å»ºæœ¬åœ°ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
cp .env.example .env

# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿
cat > .env.production << 'EOF'
# ç”Ÿäº§ç¯å¢ƒé…ç½®
APP_ENV=production
DEBUG=False
LOG_LEVEL=WARNING

# æ•°æ®åº“é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
CLICKHOUSE_HOST=your-production-host
CLICKHOUSE_PORT=8123
CLICKHOUSE_USER=prod_user
CLICKHOUSE_PASSWORD=your-secure-password
CLICKHOUSE_DATABASE=pulse_trader_prod
EOF
```

### 2.2 åˆ›å»ºåº”ç”¨é…ç½®ç®¡ç†æ¨¡å—

```bash
# åˆ›å»ºé…ç½®ç®¡ç†ç±»
cat > src/config/__init__.py << 'EOF'
"""
åº”ç”¨é…ç½®ç®¡ç†æ¨¡å—
"""

import os
from typing import Dict, Any, Optional
from dataclasses import dataclass
from pathlib import Path

@dataclass
class DatabaseConfig:
    """æ•°æ®åº“é…ç½®"""
    host: str = 'localhost'
    port: int = 8123
    user: str = 'quant_user'
    password: str = 'Quant@2024'
    database: str = 'pulse_trader'

@dataclass
class RedisConfig:
    """Redisé…ç½®"""
    host: str = 'localhost'
    port: int = 6379
    db: int = 0
    password: Optional[str] = None

@dataclass
class AppSettings:
    """åº”ç”¨è®¾ç½®"""
    env: str = 'development'
    debug: bool = True
    log_level: str = 'INFO'

    # æ•°æ®è·¯å¾„
    project_root: Path = Path(__file__).parent.parent.parent
    data_dir: Path = project_root / 'data'
    config_dir: Path = project_root / 'config'
    logs_dir: Path = project_root / 'data' / 'logs'

    # äº¤æ˜“è®¾ç½®
    default_capital: float = 1000000.0
    max_position_size: float = 0.1
    commission_rate: float = 0.0003

class ConfigManager:
    """é…ç½®ç®¡ç†å™¨"""

    def __init__(self, env_file: str = '.env'):
        self.env_file = env_file
        self._load_env()

    def _load_env(self):
        """åŠ è½½ç¯å¢ƒå˜é‡"""
        if os.path.exists(self.env_file):
            with open(self.env_file, 'r') as f:
                for line in f:
                    line = line.strip()
                    if line and not line.startswith('#') and '=' in line:
                        key, value = line.split('=', 1)
                        os.environ[key] = value.strip()

    def get_database_config(self) -> DatabaseConfig:
        """è·å–æ•°æ®åº“é…ç½®"""
        return DatabaseConfig(
            host=os.getenv('CLICKHOUSE_HOST', 'localhost'),
            port=int(os.getenv('CLICKHOUSE_PORT', '8123')),
            user=os.getenv('CLICKHOUSE_USER', 'quant_user'),
            password=os.getenv('CLICKHOUSE_PASSWORD', 'Quant@2024'),
            database=os.getenv('CLICKHOUSE_DATABASE', 'pulse_trader')
        )

    def get_redis_config(self) -> RedisConfig:
        """è·å–Redisé…ç½®"""
        return RedisConfig(
            host=os.getenv('REDIS_HOST', 'localhost'),
            port=int(os.getenv('REDIS_PORT', '6379')),
            db=int(os.getenv('REDIS_DB', '0')),
            password=os.getenv('REDIS_PASSWORD')
        )

    def get_app_settings(self) -> AppSettings:
        """è·å–åº”ç”¨è®¾ç½®"""
        return AppSettings(
            env=os.getenv('APP_ENV', 'development'),
            debug=os.getenv('DEBUG', 'True').lower() == 'true',
            log_level=os.getenv('LOG_LEVEL', 'INFO'),
            default_capital=float(os.getenv('DEFAULT_CAPITAL', '1000000.0')),
            max_position_size=float(os.getenv('MAX_POSITION_SIZE', '0.1')),
            commission_rate=float(os.getenv('COMMISSION_RATE', '0.0003'))
        )

# å…¨å±€é…ç½®ç®¡ç†å™¨å®ä¾‹
config_manager = ConfigManager()
app_settings = config_manager.get_app_settings()
db_config = config_manager.get_database_config()
redis_config = config_manager.get_redis_config()
EOF
```

### 2.3 åˆ›å»ºæ—¥å¿—é…ç½®

```bash
# åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶
cat > config/logging/logging.yaml << 'EOF'
version: 1
disable_existing_loggers: false

formatters:
  standard:
    format: '%(asctime)s [%(levelname)s] %(name)s: %(message)s'
  detailed:
    format: '%(asctime)s [%(levelname)s] %(name)s:%(lineno)d: %(message)s'
  json:
    format: '{"timestamp": "%(asctime)s", "level": "%(levelname)s", "logger": "%(name)s", "message": "%(message)s"}'

handlers:
  console:
    class: logging.StreamHandler
    level: INFO
    formatter: standard
    stream: ext://sys.stdout

  file_app:
    class: logging.handlers.RotatingFileHandler
    level: INFO
    formatter: detailed
    filename: data/logs/app/app.log
    maxBytes: 10485760  # 10MB
    backupCount: 5

  file_database:
    class: logging.handlers.RotatingFileHandler
    level: INFO
    formatter: detailed
    filename: data/logs/database/database.log
    maxBytes: 10485760
    backupCount: 5

  file_system:
    class: logging.handlers.RotatingFileHandler
    level: WARNING
    formatter: detailed
    filename: data/logs/system/system.log
    maxBytes: 10485760
    backupCount: 5

loggers:
  app:
    level: INFO
    handlers: [console, file_app]
    propagate: false

  database:
    level: INFO
    handlers: [console, file_database]
    propagate: false

  system:
    level: WARNING
    handlers: [console, file_system]
    propagate: false

root:
  level: INFO
  handlers: [console]
EOF
```

### 2.4 åˆ›å»ºæ—¥å¿—ç®¡ç†æ¨¡å—

```bash
# åˆ›å»ºæ—¥å¿—ç®¡ç†æ¨¡å—
cat > src/utils/logging.py << 'EOF'
"""
æ—¥å¿—ç®¡ç†å·¥å…·
"""

import logging
import logging.config
import yaml
import os
from pathlib import Path
from src.config import app_settings

def setup_logging():
    """è®¾ç½®æ—¥å¿—é…ç½®"""
    # ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
    log_dirs = [
        app_settings.logs_dir / 'app',
        app_settings.logs_dir / 'database',
        app_settings.logs_dir / 'system'
    ]

    for log_dir in log_dirs:
        log_dir.mkdir(parents=True, exist_ok=True)

    # åŠ è½½æ—¥å¿—é…ç½®
    config_path = app_settings.config_dir / 'logging' / 'logging.yaml'

    if config_path.exists():
        with open(config_path, 'r', encoding='utf-8') as f:
            config = yaml.safe_load(f)
        logging.config.dictConfig(config)
    else:
        # å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨åŸºç¡€é…ç½®
        logging.basicConfig(
            level=getattr(logging, app_settings.log_level),
            format='%(asctime)s [%(levelname)s] %(name)s: %(message)s'
        )

def get_logger(name: str) -> logging.Logger:
    """è·å–æŒ‡å®šåç§°çš„æ—¥å¿—è®°å½•å™¨"""
    return logging.getLogger(name)

# åˆå§‹åŒ–æ—¥å¿—
setup_logging()

# å¯¼å‡ºå¸¸ç”¨æ—¥å¿—è®°å½•å™¨
app_logger = get_logger('app')
db_logger = get_logger('database')
system_logger = get_logger('system')
EOF
```

## æ­¥éª¤3ï¼šåˆ›å»ºå·¥å…·å‡½æ•°æ¨¡å—

### 3.1 åˆ›å»ºé€šç”¨å·¥å…·å‡½æ•°

```bash
# åˆ›å»ºé€šç”¨å·¥å…·å‡½æ•°
cat > src/utils/helpers.py << 'EOF'
"""
é€šç”¨å·¥å…·å‡½æ•°
"""

import os
import sys
import json
import pickle
from datetime import datetime, date
from typing import Any, Dict, List, Optional, Union
from pathlib import Path
import pandas as pd

def ensure_dir(path: Union[str, Path]) -> Path:
    """ç¡®ä¿ç›®å½•å­˜åœ¨"""
    path = Path(path)
    path.mkdir(parents=True, exist_ok=True)
    return path

def load_json(file_path: Union[str, Path]) -> Dict:
    """åŠ è½½JSONæ–‡ä»¶"""
    with open(file_path, 'r', encoding='utf-8') as f:
        return json.load(f)

def save_json(data: Any, file_path: Union[str, Path], indent: int = 2) -> None:
    """ä¿å­˜JSONæ–‡ä»¶"""
    ensure_dir(Path(file_path).parent)
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=indent)

def load_pickle(file_path: Union[str, Path]) -> Any:
    """åŠ è½½pickleæ–‡ä»¶"""
    with open(file_path, 'rb') as f:
        return pickle.load(f)

def save_pickle(data: Any, file_path: Union[str, Path]) -> None:
    """ä¿å­˜pickleæ–‡ä»¶"""
    ensure_dir(Path(file_path).parent)
    with open(file_path, 'wb') as f:
        pickle.dump(data, f)

def format_number(num: float, decimal_places: int = 2) -> str:
    """æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º"""
    if abs(num) >= 1e9:
        return f"{num/1e9:.{decimal_places}f}B"
    elif abs(num) >= 1e6:
        return f"{num/1e6:.{decimal_places}f}M"
    elif abs(num) >= 1e3:
        return f"{num/1e3:.{decimal_places}f}K"
    else:
        return f"{num:.{decimal_places}f}"

def format_percentage(num: float, decimal_places: int = 2) -> str:
    """æ ¼å¼åŒ–ç™¾åˆ†æ¯”æ˜¾ç¤º"""
    return f"{num*100:.{decimal_places}f}%"

def validate_stock_symbol(symbol: str) -> bool:
    """éªŒè¯è‚¡ç¥¨ä»£ç æ ¼å¼"""
    import re
    # Aè‚¡ä»£ç æ ¼å¼ï¼š6ä½æ•°å­—+.+äº¤æ˜“æ‰€(SH/SZ/BJ)
    pattern = r'^\d{6}\.(SH|SZ|BJ)$'
    return bool(re.match(pattern, symbol))

def parse_stock_symbol(symbol: str) -> Optional[tuple]:
    """è§£æè‚¡ç¥¨ä»£ç """
    if validate_stock_symbol(symbol):
        code, exchange = symbol.split('.')
        return code, exchange
    return None

def trading_days_between(start_date: Union[str, date],
                       end_date: Union[str, date]) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„äº¤æ˜“æ—¥æ•°é‡ï¼ˆç®€å•è®¡ç®—ï¼Œä¸åŒ…å«èŠ‚å‡æ—¥ï¼‰"""
    if isinstance(start_date, str):
        start_date = datetime.strptime(start_date, '%Y-%m-%d').date()
    if isinstance(end_date, str):
        end_date = datetime.strptime(end_date, '%Y-%m-%d').date()

    # ç®€å•è®¡ç®—ï¼Œå‡è®¾æ¯å‘¨5ä¸ªäº¤æ˜“æ—¥
    total_days = (end_date - start_date).days
    weeks = total_days // 7
    remaining_days = total_days % 7

    # è®¡ç®—å‰©ä½™å¤©æ•°ä¸­çš„å·¥ä½œæ—¥
    work_days = 0
    start_weekday = start_date.weekday()

    for i in range(remaining_days + 1):
        current_weekday = (start_weekday + i) % 7
        if current_weekday < 5:  # å‘¨ä¸€åˆ°å‘¨äº”
            work_days += 1

    return weeks * 5 + work_days

def is_trading_day(date_check: Union[str, date]) -> bool:
    """æ£€æŸ¥æ˜¯å¦ä¸ºäº¤æ˜“æ—¥ï¼ˆç®€å•æ£€æŸ¥ï¼Œä¸è€ƒè™‘èŠ‚å‡æ—¥ï¼‰"""
    if isinstance(date_check, str):
        date_check = datetime.strptime(date_check, '%Y-%m-%d').date()

    return date_check.weekday() < 5  # å‘¨ä¸€åˆ°å‘¨äº”
EOF
```

### 3.2 åˆ›å»ºæ—¥æœŸæ—¶é—´å·¥å…·

```bash
# åˆ›å»ºæ—¥æœŸæ—¶é—´å·¥å…·
cat > src/utils/datetime_utils.py << 'EOF'
"""
æ—¥æœŸæ—¶é—´å·¥å…·å‡½æ•°
"""

import pandas as pd
from datetime import datetime, date, timedelta
from typing import List, Tuple, Union

def get_trading_dates(start_date: Union[str, date],
                     end_date: Union[str, date]) -> List[date]:
    """è·å–æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰äº¤æ˜“æ—¥ï¼ˆæ’é™¤å‘¨æœ«ï¼‰"""
    if isinstance(start_date, str):
        start_date = datetime.strptime(start_date, '%Y-%m-%d').date()
    if isinstance(end_date, str):
        end_date = datetime.strptime(end_date, '%Y-%m-%d').date()

    trading_dates = []
    current_date = start_date

    while current_date <= end_date:
        if current_date.weekday() < 5:  # å‘¨ä¸€åˆ°å‘¨äº”
            trading_dates.append(current_date)
        current_date += timedelta(days=1)

    return trading_dates

def get_last_trading_date(reference_date: Union[str, date] = None) -> date:
    """è·å–æœ€è¿‘çš„äº¤æ˜“æ—¥"""
    if reference_date is None:
        reference_date = date.today()
    elif isinstance(reference_date, str):
        reference_date = datetime.strptime(reference_date, '%Y-%m-%d').date()

    # å¦‚æœä»Šå¤©æ˜¯äº¤æ˜“æ—¥ï¼Œè¿”å›ä»Šå¤©ï¼›å¦åˆ™å¾€å‰æ¨
    if reference_date.weekday() < 5:
        return reference_date

    # å¾€å‰æ‰¾æœ€è¿‘çš„äº¤æ˜“æ—¥
    days_back = 1
    while True:
        last_date = reference_date - timedelta(days=days_back)
        if last_date.weekday() < 5:
            return last_date
        days_back += 1

def date_range(start_date: Union[str, date],
               end_date: Union[str, date],
               freq: str = 'D') -> List[date]:
    """ç”Ÿæˆæ—¥æœŸèŒƒå›´"""
    if isinstance(start_date, str):
        start_date = pd.to_datetime(start_date)
    if isinstance(end_date, str):
        end_date = pd.to_datetime(end_date)

    date_list = pd.date_range(start=start_date, end=end_date, freq=freq)
    return [d.date() for d in date_list]

def get_year_month_dates(year: int, month: int) -> Tuple[date, date]:
    """è·å–æŒ‡å®šå¹´æœˆçš„å¼€å§‹å’Œç»“æŸæ—¥æœŸ"""
    start_date = date(year, month, 1)

    if month == 12:
        end_date = date(year + 1, 1, 1) - timedelta(days=1)
    else:
        end_date = date(year, month + 1, 1) - timedelta(days=1)

    return start_date, end_date

def format_date(dt: Union[str, date, datetime],
                format_str: str = '%Y-%m-%d') -> str:
    """æ ¼å¼åŒ–æ—¥æœŸ"""
    if isinstance(dt, str):
        dt = datetime.strptime(dt, '%Y-%m-%d')

    if isinstance(dt, datetime):
        return dt.strftime(format_str)
    elif isinstance(dt, date):
        return dt.strftime(format_str)

    return str(dt)

def parse_date(dt_str: str, format_str: str = '%Y-%m-%d') -> date:
    """è§£ææ—¥æœŸå­—ç¬¦ä¸²"""
    return datetime.strptime(dt_str, format_str).date()
EOF
```

## æ­¥éª¤4ï¼šåˆ›å»º requirements.txt

```bash
# åˆ›å»ºrequirements.txtæ–‡ä»¶
cat > requirements.txt << 'EOF'
# æ ¸å¿ƒä¾èµ–
pandas==2.3.3
numpy==2.3.5
akshare==1.17.87
clickhouse-driver==0.2.10
clickhouse-pool==1.0.0
redis==5.0.1

# å¼€å‘å·¥å…·
pytest==8.0.0
pytest-cov==4.0.0
black==24.0.0
pylint==3.0.0
mypy==1.0.0
pre-commit==3.5.0

# æ•°æ®å¤„ç†
scipy==1.14.1
scikit-learn==1.5.2
matplotlib==3.9.2
seaborn==0.13.2
plotly==5.17.0

# æ—¶é—´åºåˆ—
ta-lib==0.4.28
vectorbt==0.25.2

# é…ç½®å’Œæ—¥å¿—
pyyaml==6.0.1
python-dotenv==1.0.0

# å¼‚æ­¥å’Œå¹¶å‘
aiofiles==23.2.1
aiohttp==3.9.1

# Rusté›†æˆ
maturin==1.10.2

# Jupyterç›¸å…³
jupyter==1.0.0
jupyterlab==4.0.9
notebook==7.0.6

# å¯è§†åŒ–
ipywidgets==8.1.1
bokeh==3.3.0

# æ•°æ®éªŒè¯
pydantic==2.5.0

# APIå’ŒWeb
fastapi==0.104.1
uvicorn==0.24.0
requests==2.31.0
EOF
```

## æ­¥éª¤5ï¼šåˆ›å»ºå¼€å‘é…ç½®

### 5.1 åˆ›å»ºpre-commité…ç½®

```bash
# åˆ›å»ºpre-commité…ç½®
cat > .pre-commit-config.yaml << 'EOF'
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-merge-conflict

  - repo: https://github.com/psf/black
    rev: 24.0.0
    hooks:
      - id: black
        language_version: python3.12

  - repo: https://github.com/pycqa/pylint
    rev: v3.0.0
    hooks:
      - id: pylint
        args: [--disable=C0114,C0115,C0116]

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile", "black"]
EOF

# å®‰è£…pre-commit
pip install pre-commit
pre-commit install
```

### 5.2 åˆ›å»ºMakefile

```bash
# åˆ›å»ºMakefile
cat > Makefile << 'EOF'
.PHONY: help install test lint format clean run-tests run-docker stop-docker

help:
	@echo "Available commands:"
	@echo "  install      - Install dependencies"
	@echo "  test         - Run tests"
	@echo "  lint         - Run linting"
	@echo "  format       - Format code"
	@echo "  clean        - Clean generated files"
	@echo "  run-tests    - Run all tests with coverage"
	@echo "  run-docker   - Start Docker services"
	@echo "  stop-docker  - Stop Docker services"

install:
	pip install -r requirements.txt

test:
	pytest tests/ -v

run-tests:
	pytest tests/ -v --cov=src --cov-report=html --cov-report=term

lint:
	pylint src/
	mypy src/

format:
	black src/ tests/
	isort src/ tests/

clean:
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf build/ dist/

run-docker:
	docker-compose up -d

stop-docker:
	docker-compose down

check:
	pre-commit run --all-files

setup: install run-docker
	@echo "Setup complete!"
EOF
```

## æ­¥éª¤6ï¼šéªŒè¯é¡¹ç›®ç»“æ„

### 6.1 åˆ›å»ºé¡¹ç›®éªŒè¯è„šæœ¬

```bash
# åˆ›å»ºé¡¹ç›®éªŒè¯è„šæœ¬
cat > verify_setup.py << 'EOF'
#!/usr/bin/env python3
"""
é¡¹ç›®è®¾ç½®éªŒè¯è„šæœ¬
"""

import os
import sys
from pathlib import Path

def check_directory_structure():
    """æ£€æŸ¥ç›®å½•ç»“æ„"""
    print("=== æ£€æŸ¥é¡¹ç›®ç›®å½•ç»“æ„ ===")

    required_dirs = [
        'src', 'src/data', 'src/strategies', 'src/backtest', 'src/execution', 'src/utils',
        'tests', 'tests/unit', 'tests/integration', 'tests/fixtures',
        'notebooks', 'scripts', 'config', 'docs',
        'data', 'data/raw', 'data/processed', 'data/logs', 'data/cache',
        'rust', 'rust/src', 'rust/python'
    ]

    missing_dirs = []
    for dir_path in required_dirs:
        if not Path(dir_path).exists():
            missing_dirs.append(dir_path)
        else:
            print(f"âœ“ {dir_path}")

    if missing_dirs:
        print(f"âœ— ç¼ºå°‘ç›®å½•: {missing_dirs}")
        return False

    return True

def check_required_files():
    """æ£€æŸ¥å¿…éœ€æ–‡ä»¶"""
    print("\n=== æ£€æŸ¥å¿…éœ€æ–‡ä»¶ ===")

    required_files = [
        'pyproject.toml',
        'requirements.txt',
        '.env.example',
        '.gitignore',
        'README.md',
        'docker-compose.yml'
    ]

    missing_files = []
    for file_path in required_files:
        if not Path(file_path).exists():
            missing_files.append(file_path)
        else:
            print(f"âœ“ {file_path}")

    if missing_files:
        print(f"âœ— ç¼ºå°‘æ–‡ä»¶: {missing_files}")
        return False

    return True

def check_python_modules():
    """æ£€æŸ¥Pythonæ¨¡å—"""
    print("\n=== æ£€æŸ¥Pythonæ¨¡å— ===")

    try:
        # æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯¼å…¥é¡¹ç›®æ¨¡å—
        sys.path.insert(0, 'src')

        from config import config_manager, app_settings
        print("âœ“ é…ç½®æ¨¡å—å¯¼å…¥æˆåŠŸ")

        from utils.logging import get_logger
        logger = get_logger('test')
        print("âœ“ æ—¥å¿—æ¨¡å—å¯¼å…¥æˆåŠŸ")

        from utils.helpers import validate_stock_symbol
        print("âœ“ å·¥å…·å‡½æ•°æ¨¡å—å¯¼å…¥æˆåŠŸ")

        return True

    except ImportError as e:
        print(f"âœ— æ¨¡å—å¯¼å…¥å¤±è´¥: {e}")
        return False

def check_environment():
    """æ£€æŸ¥ç¯å¢ƒå˜é‡"""
    print("\n=== æ£€æŸ¥ç¯å¢ƒå˜é‡ ===")

    if Path('.env').exists():
        print("âœ“ .envæ–‡ä»¶å­˜åœ¨")

        # åŠ è½½å¹¶æ£€æŸ¥ç¯å¢ƒå˜é‡
        with open('.env', 'r') as f:
            env_vars = {}
            for line in f:
                line = line.strip()
                if line and not line.startswith('#') and '=' in line:
                    key, value = line.split('=', 1)
                    env_vars[key] = value.strip()

        required_vars = ['CLICKHOUSE_HOST', 'CLICKHOUSE_USER', 'CLICKHOUSE_PASSWORD']
        missing_vars = []

        for var in required_vars:
            if var in env_vars:
                print(f"âœ“ {var}")
            else:
                missing_vars.append(var)

        if missing_vars:
            print(f"âœ— ç¼ºå°‘ç¯å¢ƒå˜é‡: {missing_vars}")
            return False

        return True
    else:
        print("âœ— .envæ–‡ä»¶ä¸å­˜åœ¨")
        return False

def main():
    """ä¸»éªŒè¯å‡½æ•°"""
    print("PulseTrader é¡¹ç›®è®¾ç½®éªŒè¯\n")

    checks = [
        check_directory_structure,
        check_required_files,
        check_python_modules,
        check_environment
    ]

    all_passed = True
    for check in checks:
        if not check():
            all_passed = False

    print("\n" + "="*50)
    if all_passed:
        print("ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼é¡¹ç›®è®¾ç½®å®Œæˆã€‚")
        return 0
    else:
        print("âŒ éƒ¨åˆ†æ£€æŸ¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹ä¸Šè¿°é”™è¯¯ä¿¡æ¯ã€‚")
        return 1

if __name__ == "__main__":
    sys.exit(main())
EOF
```

### 6.2 è¿è¡ŒéªŒè¯

```bash
# è¿è¡Œé¡¹ç›®éªŒè¯è„šæœ¬
python verify_setup.py
```

**é¢„æœŸæˆåŠŸè¾“å‡ºï¼š**
```
PulseTrader é¡¹ç›®è®¾ç½®éªŒè¯

=== æ£€æŸ¥é¡¹ç›®ç›®å½•ç»“æ„ ===
âœ“ src
âœ“ src/data
âœ“ src/strategies
...
âœ“ rust/python

=== æ£€æŸ¥å¿…éœ€æ–‡ä»¶ ===
âœ“ pyproject.toml
âœ“ requirements.txt
âœ“ .env.example
âœ“ .gitignore
âœ“ README.md
âœ“ docker-compose.yml

=== æ£€æŸ¥Pythonæ¨¡å— ===
âœ“ é…ç½®æ¨¡å—å¯¼å…¥æˆåŠŸ
âœ“ æ—¥å¿—æ¨¡å—å¯¼å…¥æˆåŠŸ
âœ“ å·¥å…·å‡½æ•°æ¨¡å—å¯¼å…¥æˆåŠŸ

=== æ£€æŸ¥ç¯å¢ƒå˜é‡ ===
âœ“ .envæ–‡ä»¶å­˜åœ¨
âœ“ CLICKHOUSE_HOST
âœ“ CLICKHOUSE_USER
âœ“ CLICKHOUSE_PASSWORD

==================================================
ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼é¡¹ç›®è®¾ç½®å®Œæˆã€‚
```

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**Q1: ç›®å½•åˆ›å»ºå¤±è´¥**
```bash
# æ£€æŸ¥æƒé™
ls -la
# é‡æ–°åˆ›å»ºç›®å½•
rm -rf src/ && mkdir -p src/{data,strategies,backtest,execution,utils}
```

**Q2: æ¨¡å—å¯¼å…¥å¤±è´¥**
```bash
# æ£€æŸ¥Pythonè·¯å¾„
python -c "import sys; print(sys.path)"
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
pwd
```

**Q3: ç¯å¢ƒå˜é‡åŠ è½½å¤±è´¥**
```bash
# æ‰‹åŠ¨åˆ›å»º.envæ–‡ä»¶
cp .env.example .env
# æ£€æŸ¥æ–‡ä»¶å†…å®¹
cat .env
```

## æœ¬èŠ‚å°ç»“

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº†å®Œæ•´çš„é¡¹ç›®ç»“æ„å’ŒåŸºç¡€é…ç½®ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å­¦ä¼šäº†ï¼š

1. âœ… åˆ›å»ºæ ‡å‡†åŒ–çš„é¡¹ç›®ç›®å½•ç»“æ„
2. âœ… é…ç½®ç¯å¢ƒå˜é‡å’Œé…ç½®ç®¡ç†
3. âœ… è®¾ç½®æ—¥å¿—ç³»ç»Ÿå’Œå·¥å…·å‡½æ•°
4. âœ… åˆ›å»ºå¼€å‘å·¥å…·é…ç½®
5. âœ… éªŒè¯é¡¹ç›®ç»“æ„å®Œæ•´æ€§

## ğŸ¯ ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨çš„é¡¹ç›®ç»“æ„å·²ç»å®Œæ•´ï¼Œå¯ä»¥åœ¨ä¸‹ä¸€èŠ‚å­¦ä¹ å¼€å‘å·¥å…·çš„å®Œæ•´é…ç½®å’Œç¯å¢ƒéªŒè¯ã€‚

**[â†’ ç»§ç»­å­¦ä¹  1.4 å¼€å‘å·¥å…·ä¸ç¯å¢ƒéªŒè¯](1.4-å¼€å‘å·¥å…·ä¸ç¯å¢ƒéªŒè¯.md)**

## ğŸ’¡ æç¤º

- ä½¿ç”¨ `make help` æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
- å®šæœŸè¿è¡Œ `verify_setup.py` ç¡®ä¿é¡¹ç›®é…ç½®æ­£ç¡®
- ä½¿ç”¨ `make check` è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥
- ä¿æŒé¡¹ç›®ç»“æ„æ•´æ´ï¼ŒæŒ‰æ¨¡å—ç»„ç»‡ä»£ç 
