# 1.1 Python 3.12开发环境配置

## 📋 学习目标
- 安装并配置 Python 3.12 开发环境
- 设置专业的开发工具链
- 创建标准化的项目结构

## ⏱️ 预计完成时间
15-20分钟

---

## 步骤1：检查当前Python版本

首先检查系统中是否已经安装了Python：

```bash
# 检查Python版本
python3 --version
python --version

# 如果版本不是3.12.x，我们需要安装最新版本
```

**预期输出示例：**
```
Python 3.11.5  # 如果显示这个版本，需要升级到3.12
```

## 步骤2：安装Python 3.12

### 在Ubuntu/WSL2上安装：

```bash
# 更新包列表
sudo apt update

# 添加deadsnakes PPA（包含最新的Python版本）
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update

# 安装Python 3.12及相关工具
sudo apt install python3.12 python3.12-venv python3.12-dev python3.12-pip

# 验证安装
python3.12 --version
```

### 在macOS上安装：

```bash
# 使用Homebrew安装
brew install python@3.12

# 验证安装
python3.12 --version
```

### 在Windows上安装：

1. 访问 [python.org](https://python.org)
2. 下载Python 3.12最新稳定版
3. 运行安装程序，**务必勾选"Add Python to PATH"**
4. 验证安装：打开命令提示符输入 `python --version`

## 步骤3：创建项目虚拟环境

虚拟环境可以隔离项目依赖，避免不同项目间的版本冲突。

```bash
# 切换到项目目录
cd /home/jackluo/data/PulseTrader

# 创建Python 3.12虚拟环境
python3.12 -m venv .venv

# 激活虚拟环境
# Linux/macOS:
source .venv/bin/activate
# Windows:
# .venv\Scripts\activate

# 验证虚拟环境
which python  # 应该显示项目目录下的python路径
python --version  # 应该显示Python 3.12.x
```

**成功激活后，你会看到命令行前面有 `(.venv)` 标识。**

## 步骤4：升级pip和安装基础工具

```bash
# 升级pip到最新版本
pip install --upgrade pip

# 安装项目管理和打包工具
pip install poetry setuptools wheel maturin

# 验证安装
poetry --version
maturin --version
```

## 步骤5：配置开发工具

### 5.1 安装VS Code（如果尚未安装）

```bash
# Ubuntu/WSL2
sudo snap install code --classic

# 或者从官网下载：https://code.visualstudio.com/
```

### 5.2 安装必要的VS Code扩展

打开VS Code，按 `Ctrl+Shift+X` 打开扩展面板，安装以下扩展：

1. **Python** (Microsoft官方) - Python语言支持
2. **Pylance** - Python智能提示和类型检查
3. **Python Docstring Generator** - 自动生成文档字符串
4. **GitLens** - Git增强功能
5. **Docker** - 容器支持（后续章节需要）
6. **ClickHouse** - ClickHouse数据库支持

### 5.3 配置VS Code Python设置

在VS Code中按 `Ctrl+Shift+P`，输入 `Open Settings (JSON)`，添加以下配置：

```json
{
    "python.defaultInterpreterPath": "./.venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.formatting.provider": "black",
    "python.formatting.blackArgs": ["--line-length=88"],
    "python.testing.pytestEnabled": true,
    "files.exclude": {
        "**/__pycache__": true,
        "**/*.pyc": true
    }
}
```

## 步骤6：创建项目配置文件

### 6.1 创建 `pyproject.toml`

```bash
# 在项目根目录创建配置文件
cat > pyproject.toml << 'EOF'
[tool.poetry]
name = "pulse-trader"
version = "0.1.0"
description = "A股量化交易系统"
authors = ["Your Name <your.email@example.com>"]
readme = "README.md"
python = "^3.12"

[tool.poetry.dependencies]
python = "^3.12"
pandas = "^2.3.3"
numpy = "^2.3.5"
akshare = "^1.17.87"
clickhouse-driver = "^0.2.10"

[tool.poetry.group.dev.dependencies]
pytest = "^8.0.0"
black = "^24.0.0"
pylint = "^3.0.0"
mypy = "^1.0.0"
maturin = "^1.10.2"

[tool.maturin]
python-source = "python"
module-name = "pulse_trader_rust._core"
features = ["pyo3/extension-module"]

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 88
target-version = ['py312']

[tool.pylint.messages_control]
disable = ["C0114", "C0115", "C0116"]
EOF
```

### 6.2 创建 `.gitignore`

```bash
cat > .gitignore << 'EOF'
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# Virtual Environment
.venv/
venv/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo

# Data
data/raw/*
data/processed/*
!data/raw/.gitkeep
!data/processed/.gitkeep

# Logs
logs/
*.log

# Environment Variables
.env
.env.local

# Database
*.db
*.sqlite

# OS
.DS_Store
Thumbs.db
EOF
```

## 步骤7：验证环境配置

```bash
# 安装项目依赖
pip install pandas numpy akshare clickhouse-driver

# 创建测试脚本验证环境
cat > test_environment.py << 'EOF'
#!/usr/bin/env python3
"""
环境测试脚本
验证所有依赖是否正确安装
"""

def test_imports():
    """测试所有核心库的导入"""
    try:
        import pandas as pd
        print(f"✓ pandas: {pd.__version__}")
    except ImportError as e:
        print(f"✗ pandas导入失败: {e}")

    try:
        import numpy as np
        print(f"✓ numpy: {np.__version__}")
    except ImportError as e:
        print(f"✗ numpy导入失败: {e}")

    try:
        import akshare as ak
        print(f"✓ akshare: {ak.__version__}")
    except ImportError as e:
        print(f"✗ akshare导入失败: {e}")

    try:
        import clickhouse_driver
        print(f"✓ clickhouse_driver: 成功导入")
    except ImportError as e:
        print(f"✗ clickhouse_driver导入失败: {e}")

def test_basic_functionality():
    """测试基础功能"""
    try:
        import pandas as pd
        import numpy as np

        # 测试pandas基础操作
        df = pd.DataFrame({
            'date': pd.date_range('2024-01-01', periods=5),
            'price': [100.0, 101.5, 99.8, 102.3, 103.1]
        })
        print(f"✓ pandas DataFrame创建成功: {df.shape}")

        # 测试numpy基础操作
        arr = np.array([1, 2, 3, 4, 5])
        print(f"✓ numpy数组操作成功: mean={arr.mean()}")

    except Exception as e:
        print(f"✗ 基础功能测试失败: {e}")

if __name__ == "__main__":
    print("=== 环境测试开始 ===")
    test_imports()
    test_basic_functionality()
    print("=== 环境测试完成 ===")
EOF

# 运行测试脚本
python test_environment.py
```

**预期成功输出：**
```
=== 环境测试开始 ===
✓ pandas: 2.3.3
✓ numpy: 2.3.5
✓ akshare: 1.17.87
✓ clickhouse_driver: 成功导入
✓ pandas DataFrame创建成功: (5, 2)
✓ numpy数组操作成功: mean=3.0
=== 环境测试完成 ===
```

## 步骤8：创建项目目录结构

```bash
# 创建标准项目目录结构
mkdir -p src/{data,strategies,backtest,execution,utils}
mkdir -p tests/{unit,integration,fixtures}
mkdir -p notebooks
mkdir -p scripts
mkdir -p config
mkdir -p docs
mkdir -p data/{raw,processed,logs}
mkdir -p rust/{src,python/pulse_trader_rust}

# 创建__init__.py文件使目录成为Python包
touch src/__init__.py
touch src/data/__init__.py
touch src/strategies/__init__.py
touch src/backtest/__init__.py
touch src/execution/__init__.py
touch src/utils/__init__.py
touch tests/__init__.py

# 创建Rust-Python集成目录的__init__.py
touch rust/python/pulse_trader_rust/__init__.py

# 创建占位文件
touch data/raw/.gitkeep
touch data/processed/.gitkeep
touch data/logs/.gitkeep

# 验证目录结构
tree -L 2
```

## 步骤9：创建README文件

```bash
cat > README.md << 'EOF'
# PulseTrader - A股量化交易系统

基于 Rust + Python + ClickHouse + Akshare 的现代化A股量化交易系统。

## 技术栈

- **Python 3.12**: 主要开发语言
- **Rust**: 高性能计算模块
- **Maturin + PyO3**: 现代化Rust-Python集成方案
- **ClickHouse**: 时序数据库
- **Akshare**: A股数据源

## 快速开始

### 环境要求

- Python 3.12+
- Git
- Docker (用于ClickHouse)

### 安装步骤

1. 克隆仓库
```bash
git clone <repository-url>
cd PulseTrader
```

2. 创建虚拟环境
```bash
python3.12 -m venv .venv
source .venv/bin/activate  # Linux/macOS
# 或 .venv\Scripts\activate  # Windows
```

3. 安装依赖
```bash
pip install -r requirements.txt
```

4. 运行测试
```bash
python test_environment.py
```

## 项目结构

```
PulseTrader/
├── src/                    # 源代码
│   ├── data/              # 数据获取和处理
│   ├── strategies/        # 交易策略
│   ├── backtest/          # 回测引擎
│   ├── execution/         # 交易执行
│   └── utils/             # 工具函数
├── tests/                 # 测试代码
├── notebooks/            # Jupyter笔记本
├── scripts/              # 脚本文件
├── config/               # 配置文件
├── rust/                 # Rust高性能模块
│   ├── src/              # Rust源代码
│   ├── python/           # Python绑定代码
│   └── Cargo.toml        # Rust项目配置
└── data/                 # 数据文件
```

## 开发进度

- [x] 第一章：环境搭建与项目初始化
- [ ] 第二章：数据获取与存储
- [ ] 第三章：基础技术指标实现
- [ ] 第四章：策略开发框架
- [ ] 第五章：回测系统构建

## 贡献

欢迎提交Issue和Pull Request。

## 许可证

MIT License
EOF
```

## 步骤10：创建Rust集成基础文件

为后续的Rust高性能模块做准备，创建基础的Rust项目文件：

```bash
# 创建Rust项目配置文件
cat > rust/Cargo.toml << 'EOF'
[package]
name = "pulse-trader-rust"
version = "0.1.0"
edition = "2021"

[lib]
name = "pulse_trader_rust"
crate-type = ["cdylib"]

[dependencies]
pyo3 = { version = "0.22", features = ["extension-module"] }
numpy = "0.21"
polars = { version = "0.42", features = ["lazy"] }
tokio = { version = "1.0", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
EOF

# 创建基础Rust库文件
cat > rust/src/lib.rs << 'EOF'
use pyo3::prelude::*;

/// Python模块定义
#[pymodule]
fn pulse_trader_rust(_py: Python, m: &PyModule) -> PyResult<()> {
    m.add("__version__", env!("CARGO_PKG_VERSION"))?;
    m.add("__author__", "PulseTrader Team")?;
    Ok(())
}
EOF
```

## 关于Maturin + PyO3的说明

**为什么选择Maturin？**

1. **简化构建**: Maturin自动处理复杂的Rust-Python绑定过程
2. **无缝集成**: 与pip、poetry等Python包管理工具完美配合
3. **高性能**: 基于PyO3，提供接近原生C的性能
4. **开发友好**: 支持热重载，调试更方便

**Maturin工作流程：**
```bash
# 开发模式编译（支持热重载）
maturin develop

# 生产模式构建
maturin build --release

# 发布到PyPI
maturin publish
```

这个组合将在第三章详细讲解，现在我们先准备好基础环境。

## 常见问题与解决方案

**Q1: `python3.12: command not found`**
```bash
# 解决方案：检查是否正确添加到PATH
echo $PATH | grep python

# 如果没有，手动添加到 ~/.bashrc 或 ~/.zshrc
export PATH="/usr/bin/python3.12:$PATH"
```

**Q2: 虚拟环境激活失败**
```bash
# 解决方案：重新创建虚拟环境
rm -rf .venv
python3.12 -m venv .venv
source .venv/bin/activate
```

**Q3: pip安装依赖失败**
```bash
# 解决方案：升级pip并使用国内镜像
pip install --upgrade pip
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pandas numpy
```

**Q4: VS Code无法识别虚拟环境**
```bash
# 解决方案：在VS Code中重新选择Python解释器
# 按 Ctrl+Shift+P，输入 "Python: Select Interpreter"
# 选择 ./.venv/bin/python
```

## 本节小结

恭喜！您已经成功完成了Python 3.12开发环境的配置。在本节中，您学会了：

1. ✅ 安装Python 3.12最新稳定版
2. ✅ 创建和配置虚拟环境
3. ✅ 安装和配置专业开发工具
4. ✅ 创建标准化的项目结构
5. ✅ 验证环境配置正确性

## 🎯 下一步

完成环境配置后，您将在下一节学习如何安装和配置ClickHouse数据库，为存储股票数据做好准备。

**[→ 继续学习 1.2 ClickHouse数据库安装与配置](1.2-ClickHouse数据库安装与配置.md)**

## 💡 提示

- 每次开发前，记得先激活虚拟环境：`source .venv/bin/activate`
- 如果遇到问题，可以查看本节的"常见问题与解决方案"部分
- 保存好你的项目配置，后续章节会在此基础上继续开发