# 1.2 ClickHouseæ•°æ®åº“å®‰è£…ä¸é…ç½®

## ğŸ“‹ å­¦ä¹ ç›®æ ‡
- ä½¿ç”¨Dockeréƒ¨ç½²ClickHouseæ•°æ®åº“
- é…ç½®é€‚åˆAè‚¡é‡åŒ–äº¤æ˜“çš„æ•°æ®è¡¨ç»“æ„
- å»ºç«‹Python-ClickHouseè¿æ¥
- éªŒè¯æ•°æ®åº“å®‰è£…å’Œæ•°æ®æ“ä½œ

## â±ï¸ é¢„è®¡å®Œæˆæ—¶é—´
20-25åˆ†é’Ÿ

---

## æ­¥éª¤1ï¼šDockerç¯å¢ƒå‡†å¤‡

é¦–å…ˆç¡®ä¿Dockerç¯å¢ƒæ­£å¸¸å·¥ä½œï¼š

```bash
# æ£€æŸ¥Dockerå®‰è£…çŠ¶æ€
docker --version
docker-compose --version

# å¦‚æœæœªå®‰è£…Dockerï¼Œåœ¨Ubuntu/WSL2ä¸Šå®‰è£…ï¼š
sudo apt update
sudo apt install docker.io docker-compose-plugin

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼ˆé¿å…æ¯æ¬¡ä½¿ç”¨sudoï¼‰
sudo usermod -aG docker $USER
newgrp docker

# éªŒè¯Dockeræ˜¯å¦æ­£å¸¸å·¥ä½œ
docker run hello-world
```

**é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š**
```
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

## æ­¥éª¤2ï¼šåˆ›å»ºClickHouseé…ç½®æ–‡ä»¶

### 2.1 åˆ›å»ºdocker-composeé…ç½®

```bash
# åˆ›å»ºdocker-compose.ymlæ–‡ä»¶
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  clickhouse:
    image: clickhouse/clickhouse-server:24.3.8.43
    container_name: pulse-trader-clickhouse
    hostname: clickhouse
    ports:
      - "8123:8123"  # HTTP interface
      - "9000:9000"  # Native interface
    volumes:
      - ./config/clickhouse:/etc/clickhouse-server/config.d
      - clickhouse_data:/var/lib/clickhouse
      - clickhouse_logs:/var/log/clickhouse-server
    environment:
      CLICKHOUSE_DB: pulse_trader
      CLICKHOUSE_USER: quant_user
      CLICKHOUSE_PASSWORD: Quant@2024
      CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: 1
    networks:
      - quant_network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8123/ping"]
      interval: 10s
      timeout: 5s
      retries: 3

  redis:
    image: redis:7.2-alpine
    container_name: pulse-trader-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - quant_network
    command: redis-server --appendonly yes

volumes:
  clickhouse_data:
  clickhouse_logs:
  redis_data:

networks:
  quant_network:
    driver: bridge
EOF
```

### 2.2 åˆ›å»ºClickHouseæ€§èƒ½ä¼˜åŒ–é…ç½®


```bash
# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p config/clickhouse

# åˆ›å»ºæ€§èƒ½ä¼˜åŒ–é…ç½®
cat > config/clickhouse/quant_optimization.xml << 'EOF'
<?xml version="1.0"?>
<clickhouse>
    <!-- å†…å­˜é…ç½® -->
    <max_memory_usage>10000000000</max_memory_usage>
    <max_bytes_before_external_group_by>10000000000</max_bytes_before_external_group_by>

    <!-- å¹¶å‘é…ç½® -->
    <max_threads>8</max_threads>
    <max_insert_threads>4</max_insert_threads>

    <!-- åˆå¹¶æ ‘ä¼˜åŒ– -->
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
        <parts_to_delay_insert>150</parts_to_delay_insert>
        <parts_to_throw_insert>300</parts_to_throw_insert>
        <max_bytes_to_merge_at_max_space_in_pool>1048576000</max_bytes_to_merge_at_max_space_in_pool>
    </merge_tree>

    <!-- æ—¥å¿—é…ç½® -->
    <logger>
        <level>warning</level>
        <console>true</console>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
    </logger>

    <!-- æ—¶åŒºè®¾ç½® -->
    <timezone>Asia/Shanghai</timezone>
</clickhouse>
EOF
```

## æ­¥éª¤3ï¼šå¯åŠ¨ClickHouseæœåŠ¡

```bash
# å¯åŠ¨ClickHouseå’ŒRedisæœåŠ¡
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆ
echo "ç­‰å¾…ClickHouseæœåŠ¡å¯åŠ¨..."
sleep 30

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# æ£€æŸ¥ClickHouseæœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8123/ping

# é¢„æœŸè¾“å‡ºåº”è¯¥æ˜¯ "OK."
```

**å¦‚æœæœåŠ¡çŠ¶æ€æ˜¾ç¤ºhealthyï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼**

## æ­¥éª¤4ï¼šåˆ›å»ºAè‚¡æ•°æ®è¡¨ç»“æ„

### 4.1 åˆ›å»ºSQLè„šæœ¬æ–‡ä»¶

```bash
# åˆ›å»ºSQLè„šæœ¬ç›®å½•
mkdir -p scripts/database

# åˆ›å»ºAè‚¡æ•°æ®è¡¨ç»“æ„è„šæœ¬
cat > scripts/database/create_tables.sql << 'EOF'
-- PulseTrader Aè‚¡é‡åŒ–äº¤æ˜“æ•°æ®åº“è¡¨ç»“æ„

-- ä½¿ç”¨ä¸“é—¨çš„æ•°æ®åº“
USE pulse_trader;

-- 1. è‚¡ç¥¨åŸºç¡€ä¿¡æ¯è¡¨
CREATE TABLE IF NOT EXISTS stock_info (
    symbol String,           -- è‚¡ç¥¨ä»£ç  (å¦‚: 000001.SZ)
    name String,             -- è‚¡ç¥¨åç§°
    market String,           -- å¸‚åœº (SH/SZ/BJ)
    industry String,         -- è¡Œä¸š
    sector String,           -- æ¿å—
    list_date Date,          -- ä¸Šå¸‚æ—¥æœŸ
    delist_date Nullable(Date), -- é€€å¸‚æ—¥æœŸ
    is_active UInt8 DEFAULT 1,
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
PARTITION BY market
ORDER BY (symbol, created_at);

-- 2. æ—¥çº¿è¡Œæƒ…æ•°æ®è¡¨ (Aè‚¡ä¸“ç”¨)
CREATE TABLE IF NOT EXISTS stock_daily (
    symbol String,           -- è‚¡ç¥¨ä»£ç 
    trade_date Date,         -- äº¤æ˜“æ—¥æœŸ
    open Decimal(18, 4),     -- å¼€ç›˜ä»·
    high Decimal(18, 4),     -- æœ€é«˜ä»·
    low Decimal(18, 4),      -- æœ€ä½ä»·
    close Decimal(18, 4),    -- æ”¶ç›˜ä»·
    volume UInt64,           -- æˆäº¤é‡(è‚¡)
    amount Decimal(18, 2),   -- æˆäº¤é¢(å…ƒ)
    turnover_rate Decimal(8, 4), -- æ¢æ‰‹ç‡
    pe_ratio Decimal(10, 4), -- å¸‚ç›ˆç‡
    pb_ratio Decimal(10, 4), -- å¸‚å‡€ç‡
    cap_total Decimal(18, 2), -- æ€»å¸‚å€¼
    cap_flow Decimal(18, 2),  -- æµé€šå¸‚å€¼
    limit_up UInt8 DEFAULT 0, -- æ¶¨åœæ ‡è®°
    limit_down UInt8 DEFAULT 0, -- è·Œåœæ ‡è®°
    created_at DateTime DEFAULT now()
) ENGINE = ReplacingMergeTree()
PARTITION BY toYYYYMM(trade_date)
ORDER BY (symbol, trade_date);

-- 3. åˆ†é’Ÿçº¿æ•°æ®è¡¨ (ç”¨äºé«˜é¢‘ç­–ç•¥)
CREATE TABLE IF NOT EXISTS stock_1min (
    symbol String,           -- è‚¡ç¥¨ä»£ç 
    datetime DateTime,       -- æ—¶é—´æˆ³
    open Decimal(18, 4),     -- å¼€ç›˜ä»·
    high Decimal(18, 4),     -- æœ€é«˜ä»·
    low Decimal(18, 4),      -- æœ€ä½ä»·
    close Decimal(18, 4),    -- æ”¶ç›˜ä»·
    volume UInt64,           -- æˆäº¤é‡
    amount Decimal(18, 2),   -- æˆäº¤é¢
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
PARTITION BY toYYYYMMDD(datetime)
ORDER BY (symbol, datetime);

-- 4. æŠ€æœ¯æŒ‡æ ‡è¡¨
CREATE TABLE IF NOT EXISTS stock_indicators (
    symbol String,           -- è‚¡ç¥¨ä»£ç 
    trade_date Date,         -- äº¤æ˜“æ—¥æœŸ
    indicator_name String,   -- æŒ‡æ ‡åç§°
    indicator_value Decimal(18, 6), -- æŒ‡æ ‡å€¼
    period_param UInt16,     -- å‚æ•°å‘¨æœŸ
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
PARTITION BY (indicator_name, toYYYYMM(trade_date))
ORDER BY (symbol, trade_date, indicator_name);

-- 5. äº¤æ˜“ä¿¡å·è¡¨
CREATE TABLE IF NOT EXISTS trading_signals (
    signal_id UUID,          -- ä¿¡å·ID
    symbol String,           -- è‚¡ç¥¨ä»£ç 
    strategy_name String,    -- ç­–ç•¥åç§°
    signal_type String,      -- ä¿¡å·ç±»å‹ (BUY/SELL/HOLD)
    signal_time DateTime,    -- ä¿¡å·æ—¶é—´
    price Decimal(18, 4),    -- è§¦å‘ä»·æ ¼
    confidence Decimal(5, 4), -- ç½®ä¿¡åº¦
    reason String,           -- ä¿¡å·åŸå› 
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(signal_time)
ORDER BY (strategy_name, symbol, signal_time);

-- 6. å›æµ‹ç»“æœè¡¨
CREATE TABLE IF NOT EXISTS backtest_results (
    result_id UUID,          -- ç»“æœID
    strategy_name String,    -- ç­–ç•¥åç§°
    start_date Date,         -- å¼€å§‹æ—¥æœŸ
    end_date Date,           -- ç»“æŸæ—¥æœŸ
    initial_capital Decimal(18, 2), -- åˆå§‹èµ„é‡‘
    final_capital Decimal(18, 2),   -- æœ€ç»ˆèµ„é‡‘
    total_return Decimal(8, 4),      -- æ€»æ”¶ç›Šç‡
    annual_return Decimal(8, 4),     -- å¹´åŒ–æ”¶ç›Šç‡
    max_drawdown Decimal(8, 4),      -- æœ€å¤§å›æ’¤
    sharpe_ratio Decimal(8, 4),      -- å¤æ™®æ¯”ç‡
    win_rate Decimal(5, 4),          -- èƒœç‡
    profit_loss_ratio Decimal(8, 4), -- ç›ˆäºæ¯”
    total_trades UInt32,             -- æ€»äº¤æ˜“æ¬¡æ•°
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(created_at)
ORDER BY (strategy_name, created_at);

-- åˆ›å»ºè§†å›¾ï¼šæœ€æ–°è‚¡ç¥¨ä»·æ ¼
CREATE VIEW IF NOT EXISTS v_latest_price AS
SELECT
    symbol,
    trade_date,
    close as latest_price,
    volume,
    amount,
    turnover_rate
FROM stock_daily
WHERE trade_date = (
    SELECT MAX(trade_date)
    FROM stock_daily
    WHERE stock_daily.symbol = stock_daily.symbol
);

-- æ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®
INSERT INTO stock_info (symbol, name, market, industry, list_date) VALUES
('000001.SZ', 'å¹³å®‰é“¶è¡Œ', 'SZ', 'é“¶è¡Œ', '1991-04-03'),
('000002.SZ', 'ä¸‡ç§‘A', 'SZ', 'æˆ¿åœ°äº§', '1991-01-29'),
('600000.SH', 'æµ¦å‘é“¶è¡Œ', 'SH', 'é“¶è¡Œ', '1999-11-10'),
('600036.SH', 'æ‹›å•†é“¶è¡Œ', 'SH', 'é“¶è¡Œ', '2002-04-09');

-- æŸ¥çœ‹åˆ›å»ºçš„è¡¨
SHOW TABLES;
EOF
```

### 4.2 æ‰§è¡ŒSQLè„šæœ¬

```bash
# æ‰§è¡Œè¡¨åˆ›å»ºè„šæœ¬
docker exec pulse-trader-clickhouse clickhouse-client \
  --user quant_user \
  --password Quant@2024 \
  --database pulse_trader \
  --queries-file scripts/database/create_tables.sql

# éªŒè¯è¡¨åˆ›å»ºç»“æœ
docker exec pulse-trader-clickhouse clickhouse-client \
  --user quant_user \
  --password Quant@2024 \
  --database pulse_trader \
  --query "SHOW TABLES"
```

**é¢„æœŸè¾“å‡ºåº”è¯¥æ˜¾ç¤ºæ‰€æœ‰åˆ›å»ºçš„è¡¨åç§°ã€‚**

## æ­¥éª¤5ï¼šPython-ClickHouseè¿æ¥é…ç½®

### 5.1 å®‰è£…Pythonå®¢æˆ·ç«¯

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
source .venv/bin/activate

# å®‰è£…ClickHouse Pythonå®¢æˆ·ç«¯å’Œç›¸å…³åº“
pip install clickhouse-driver clickhouse-pool redis pandas

# éªŒè¯å®‰è£…
python -c "import clickhouse_driver; print('ClickHouse driver installed successfully')"
```

### 5.2 åˆ›å»ºæ•°æ®åº“è¿æ¥ç±»

```bash
# åˆ›å»ºæ•°æ®åº“æ“ä½œæ¨¡å—ç›®å½•
mkdir -p src/data

# åˆ›å»ºæ•°æ®åº“è¿æ¥å’Œæ“ä½œç±»
cat > src/data/database.py << 'EOF'
"""
ClickHouseæ•°æ®åº“æ“ä½œç±»
æä¾›è¿æ¥ç®¡ç†ã€æ•°æ®æŸ¥è¯¢å’Œæ’å…¥åŠŸèƒ½
"""

import logging
from typing import List, Dict, Any, Optional
from clickhouse_driver import Client
from clickhouse_pool import ChPool
import redis
import pandas as pd
from datetime import datetime, date
import json

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class ClickHouseManager:
    """ClickHouseæ•°æ®åº“ç®¡ç†å™¨"""

    def __init__(self, host='localhost', port=8123,
                 user='quant_user', password='Quant@2024',
                 database='pulse_trader'):
        """åˆå§‹åŒ–ClickHouseè¿æ¥"""
        self.host = host
        self.port = port
        self.user = user
        self.password = password
        self.database = database

        # åˆ›å»ºè¿æ¥æ± 
        self.pool = ChPool(
            host=host,
            port=port,
            user=user,
            password=password,
            database=database,
            connections_min=5,
            connections_max=20
        )

        # Redisç¼“å­˜è¿æ¥
        self.redis_client = redis.Redis(host='localhost', port=6379, db=0)

        # å•ä¾‹è¿æ¥ï¼ˆç”¨äºå¤æ‚æŸ¥è¯¢ï¼‰
        self.client = Client(
            host=host,
            port=port,
            user=user,
            password=password,
            database=database
        )

        logger.info("ClickHouseè¿æ¥åˆå§‹åŒ–å®Œæˆ")

    def test_connection(self) -> bool:
        """æµ‹è¯•æ•°æ®åº“è¿æ¥"""
        try:
            result = self.client.execute('SELECT 1')
            if result[0][0] == 1:
                logger.info("ClickHouseè¿æ¥æµ‹è¯•æˆåŠŸ")
                return True
        except Exception as e:
            logger.error(f"ClickHouseè¿æ¥æµ‹è¯•å¤±è´¥: {e}")
            return False

    def execute_query(self, query: str, params: Dict = None) -> Any:
        """æ‰§è¡ŒæŸ¥è¯¢"""
        try:
            with self.pool.get_client() as client:
                if params:
                    return client.execute(query, params)
                else:
                    return client.execute(query)
        except Exception as e:
            logger.error(f"æŸ¥è¯¢æ‰§è¡Œå¤±è´¥: {e}, SQL: {query}")
            raise

    def get_stock_info(self, symbol: str = None) -> pd.DataFrame:
        """è·å–è‚¡ç¥¨åŸºç¡€ä¿¡æ¯"""
        try:
            if symbol:
                query = """
                    SELECT * FROM stock_info
                    WHERE symbol = %(symbol)s AND is_active = 1
                """
                params = {'symbol': symbol}
            else:
                query = """
                    SELECT * FROM stock_info
                    WHERE is_active = 1
                    ORDER BY symbol
                """
                params = {}

            result = self.client.execute(query, params)
            columns = ['symbol', 'name', 'market', 'industry', 'sector',
                      'list_date', 'delist_date', 'is_active', 'created_at']
            df = pd.DataFrame(result, columns=columns)

            return df

        except Exception as e:
            logger.error(f"æŸ¥è¯¢è‚¡ç¥¨ä¿¡æ¯å¤±è´¥: {e}")
            return pd.DataFrame()

    def close(self):
        """å…³é—­è¿æ¥"""
        if hasattr(self, 'pool'):
            self.pool.close()
        if hasattr(self, 'redis_client'):
            self.redis_client.close()
        logger.info("ClickHouseè¿æ¥å·²å…³é—­")

# åˆ›å»ºå…¨å±€æ•°æ®åº“ç®¡ç†å™¨å®ä¾‹
db_manager = ClickHouseManager()
EOF
```

## æ­¥éª¤6ï¼šéªŒè¯æ•°æ®åº“åŠŸèƒ½

### 6.1 åˆ›å»ºæµ‹è¯•è„šæœ¬

```bash
# åˆ›å»ºæ•°æ®åº“æµ‹è¯•è„šæœ¬
cat > test_clickhouse.py << 'EOF'
#!/usr/bin/env python3
"""
ClickHouseæ•°æ®åº“åŠŸèƒ½æµ‹è¯•è„šæœ¬
éªŒè¯æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢å’ŒåŸºç¡€æ“ä½œ
"""

import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), 'src'))

from src.data.database import db_manager

def test_basic_operations():
    """æµ‹è¯•åŸºç¡€æ•°æ®åº“æ“ä½œ"""
    print("=== ClickHouseæ•°æ®åº“åŠŸèƒ½æµ‹è¯• ===")

    # 1. æµ‹è¯•è¿æ¥
    print("\n1. æµ‹è¯•æ•°æ®åº“è¿æ¥...")
    if db_manager.test_connection():
        print("âœ“ æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡")
    else:
        print("âœ— æ•°æ®åº“è¿æ¥æµ‹è¯•å¤±è´¥")
        return False

    # 2. æµ‹è¯•è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢
    print("\n2. æµ‹è¯•è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢...")
    try:
        stock_info = db_manager.get_stock_info()
        print(f"âœ“ æŸ¥è¯¢åˆ° {len(stock_info)} åªè‚¡ç¥¨")
        if len(stock_info) > 0:
            print("  ç¤ºä¾‹è‚¡ç¥¨ä¿¡æ¯:")
            print(stock_info.head(2).to_string(index=False))
    except Exception as e:
        print(f"âœ— è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢å¤±è´¥: {e}")
        return False

    print("\n=== æ•°æ®åº“åŠŸèƒ½æµ‹è¯•å®Œæˆ ===")
    return True

def cleanup():
    """æ¸…ç†èµ„æº"""
    print("\næ¸…ç†æ•°æ®åº“è¿æ¥...")
    try:
        db_manager.close()
        print("âœ“ æ•°æ®åº“è¿æ¥å·²å…³é—­")
    except Exception as e:
        print(f"âœ— æ¸…ç†å¤±è´¥: {e}")

if __name__ == "__main__":
    success = True

    # æ‰§è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•
    if not test_basic_operations():
        success = False

    # æ¸…ç†èµ„æº
    cleanup()

    if success:
        print("\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ClickHouseæ•°æ®åº“é…ç½®å®Œæˆã€‚")
        sys.exit(0)
    else:
        print("\nâŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚")
        sys.exit(1)
EOF
```

### 6.2 æ‰§è¡Œæµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_clickhouse.py
```

**é¢„æœŸæˆåŠŸè¾“å‡ºï¼š**
```
=== ClickHouseæ•°æ®åº“åŠŸèƒ½æµ‹è¯• ===

1. æµ‹è¯•æ•°æ®åº“è¿æ¥...
âœ“ æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡

2. æµ‹è¯•è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢...
âœ“ æŸ¥è¯¢åˆ° 4 åªè‚¡ç¥¨
  ç¤ºä¾‹è‚¡ç¥¨ä¿¡æ¯:
    symbol    name market industry   list_date delist_date is_active                 created_at
  000001.SZ å¹³å®‰é“¶è¡Œ      SZ      é“¶è¡Œ 1991-04-03        None          1 2024-11-24 12:00:00

=== æ•°æ®åº“åŠŸèƒ½æµ‹è¯•å®Œæˆ ===

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ClickHouseæ•°æ®åº“é…ç½®å®Œæˆã€‚
```

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**Q1: Dockerå¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
sudo systemctl status docker

# é‡å¯DockeræœåŠ¡
sudo systemctl restart docker

# æ¸…ç†Dockerèµ„æº
docker system prune -f
```

**Q2: ClickHouseè¿æ¥è¶…æ—¶**
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep 8123

# ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
# ä¾‹å¦‚æ”¹ä¸º 8124:8123
```

**Q3: æƒé™è®¿é—®é”™è¯¯**
```bash
# é‡æ–°åˆ›å»ºç”¨æˆ·æƒé™
docker exec pulse-trader-clickhouse clickhouse-client \
  --query "GRANT ALL ON pulse_trader.* TO quant_user"
```

## æœ¬èŠ‚å°ç»“

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸå®Œæˆäº†ClickHouseæ•°æ®åº“çš„å®‰è£…å’Œé…ç½®ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å­¦ä¼šäº†ï¼š

1. âœ… ä½¿ç”¨Dockeréƒ¨ç½²ClickHouseæ•°æ®åº“
2. âœ… é…ç½®Aè‚¡ä¸“ç”¨æ•°æ®è¡¨ç»“æ„
3. âœ… å»ºç«‹Python-ClickHouseè¿æ¥æ± 
4. âœ… å®ç°æ•°æ®æŸ¥è¯¢å’Œç¼“å­˜åŠŸèƒ½
5. âœ… éªŒè¯æ•°æ®åº“æ€§èƒ½å’ŒåŠŸèƒ½

## ğŸ¯ ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨æœ‰äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„æ—¶åºæ•°æ®åº“ï¼Œå¯ä»¥åœ¨ä¸‹ä¸€èŠ‚å­¦ä¹ é¡¹ç›®ç»“æ„çš„åˆ›å»ºä¸åŸºç¡€é…ç½®ã€‚

**[â†’ ç»§ç»­å­¦ä¹  1.3 é¡¹ç›®ç»“æ„åˆ›å»ºä¸åŸºç¡€é…ç½®](1.3-é¡¹ç›®ç»“æ„åˆ›å»ºä¸åŸºç¡€é…ç½®.md)**

## ğŸ’¡ æç¤º

- ä¿æŒClickHouseæœåŠ¡è¿è¡ŒçŠ¶æ€ï¼š`docker-compose up -d`
- å®šæœŸæ£€æŸ¥æ•°æ®åº“å¥åº·çŠ¶æ€ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬
- ä½¿ç”¨Redisç¼“å­˜æé«˜æŸ¥è¯¢æ€§èƒ½
- ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è·å–çœŸå®çš„Aè‚¡æ•°æ®