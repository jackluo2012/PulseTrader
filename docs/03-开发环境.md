# 开发环境搭建指南

## 系统要求

### 基础环境
- **操作系统**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python版本**: 3.8 或更高版本
- **内存**: 最少 4GB，推荐 8GB+
- **存储空间**: 至少 10GB 可用空间

### 可选环境
- **Git**: 版本控制
- **Docker**: 容器化部署
- **IDE**: PyCharm, VS Code, 或其他Python IDE

## 环境安装步骤

### 1. Python环境安装

#### Windows系统
```bash
# 下载Python安装包
# 访问 https://www.python.org/downloads/
# 选择Python 3.8+版本下载安装

# 验证安装
python --version
pip --version
```

#### macOS系统
```bash
# 使用Homebrew安装
brew install python@3.9

# 或下载官方安装包
# 访问 https://www.python.org/downloads/macos/

# 验证安装
python3 --version
pip3 --version
```

#### Linux系统 (Ubuntu/Debian)
```bash
# 更新包管理器
sudo apt update

# 安装Python和pip
sudo apt install python3 python3-pip python3-venv

# 验证安装
python3 --version
pip3 --version
```

### 2. 项目环境配置

#### 克隆项目 (如果从Git仓库)
```bash
git clone https://github.com/your-username/PulseTrader.git
cd PulseTrader
```

#### 创建虚拟环境
```bash
# 创建项目目录
mkdir PulseTrader
cd PulseTrader

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate

# macOS/Linux
source venv/bin/activate
```

### 3. 依赖包安装

#### 创建requirements.txt
```txt
# 核心依赖
pandas>=1.3.0
numpy>=1.21.0
matplotlib>=3.4.0
plotly>=5.0.0

# 数据获取
akshare>=1.8.0
tushare>=1.2.0
yfinance>=0.1.70

# 数据存储
sqlalchemy>=1.4.0
pymysql>=1.0.0
h5py>=3.1.0

# 技术计算
scipy>=1.7.0
scikit-learn>=1.0.0
statsmodels>=0.13.0

# 回测框架
backtrader>=1.9.0
zipline-reloaded>=2.2.0

# 配置管理
pyyaml>=6.0
python-dotenv>=0.19.0

# 日志系统
loguru>=0.6.0

# 测试框架
pytest>=6.2.0
pytest-mock>=3.6.0
pytest-cov>=3.0.0

# 开发工具
black>=21.0.0
flake8>=4.0.0
mypy>=0.910

# 可视化
seaborn>=0.11.0
bokeh>=2.4.0

# 异步支持
aiohttp>=3.8.0
asyncio>=3.4.3

# 时间处理
python-dateutil>=2.8.0
pytz>=2021.3
```

#### 安装依赖
```bash
# 升级pip
pip install --upgrade pip

# 安装项目依赖
pip install -r requirements.txt

# 安装开发依赖
pip install -r requirements-dev.txt
```

### 4. IDE配置

#### VS Code配置
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": "./venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "python.testing.pytestEnabled": true,
    "python.testing.pytestArgs": ["tests/"],
    "files.exclude": {
        "**/__pycache__": true,
        "**/*.pyc": true
    }
}
```

#### PyCharm配置
1. 打开项目文件夹
2. 设置Python解释器为项目虚拟环境
3. 配置代码风格为Black
4. 启用代码检查工具

### 5. 项目结构初始化

#### 创建目录结构
```bash
# 创建主要目录
mkdir -p data/{raw,processed,storage}
mkdir -p core/{data_fetcher,indicators,strategies,backtester,risk_manager,portfolio}
mkdir -p trading/{brokers,execution,monitor}
mkdir -p analysis/{performance,visualization,reports}
mkdir -p utils/{config,logging,helpers}
mkdir -p tests/{unit,integration,e2e}
mkdir -p docs
mkdir -p notebooks
mkdir -p logs
```

#### 创建配置文件
```bash
# 创建配置文件
touch config/config.yaml
touch config/.env
touch .gitignore
touch README.md
```

## 配置文件设置

### 1. 主配置文件 (config/config.yaml)
```yaml
# 数据库配置
database:
  type: "sqlite"
  path: "data/storage/trading.db"
  # 生产环境可以使用MySQL
  # type: "mysql"
  # host: "localhost"
  # port: 3306
  # user: "trader"
  # password: "${DB_PASSWORD}"
  # database: "trading_db"

# 数据源配置
data_sources:
  primary: "akshare"
  backup: "tushare"

  # Tushare配置 (需要申请token)
  tushare:
    token: "${TUSHARE_TOKEN}"
    pro_api: "https://api.tushare.pro"

# 策略配置
strategies:
  default: "ma_cross"
  available:
    - "ma_cross"
    - "rsi_reversal"
    - "bollinger_bands"

  # 默认参数
  default_params:
    ma_short: 5
    ma_long: 20
    rsi_period: 14
    rsi_oversold: 30
    rsi_overbought: 70

# 回测配置
backtest:
  initial_capital: 1000000
  commission: 0.001
  slippage: 0.001
  benchmark: "000300.SH"  # 沪深300

# 风险管理配置
risk_management:
  max_position_size: 0.1      # 单只股票最大仓位
  max_portfolio_risk: 0.02     # 最大组合风险
  stop_loss: 0.05             # 止损比例
  take_profit: 0.1            # 止盈比例
  max_drawdown: 0.15          # 最大回撤限制

# 日志配置
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_path: "logs/trading.log"
  max_bytes: 10485760  # 10MB
  backup_count: 5

# 可视化配置
visualization:
  backend: "plotly"  # 或 "matplotlib"
  theme: "plotly_white"
  figure_size: [12, 8]
```

### 2. 环境变量文件 (config/.env)
```bash
# 数据源API密钥
TUSHARE_TOKEN=your_tushare_token_here

# 数据库密码 (如果使用MySQL)
DB_PASSWORD=your_db_password_here

# 券商API配置 (实盘交易时使用)
BROKER_API_KEY=your_broker_api_key
BROKER_SECRET_KEY=your_broker_secret_key

# 其他配置
ENVIRONMENT=development
DEBUG=True
```

### 3. .gitignore文件
```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# 虚拟环境
venv/
env/
ENV/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# 数据文件
data/raw/*
data/processed/*
!data/raw/.gitkeep
!data/processed/.gitkeep

# 日志文件
logs/
*.log

# 配置文件 (包含敏感信息)
config/.env
.env.local

# 临时文件
*.tmp
*.temp
.DS_Store
Thumbs.db

# Jupyter Notebook
.ipynb_checkpoints/

# 测试覆盖率
.coverage
htmlcov/
.pytest_cache/

# 数据库文件
*.db
*.sqlite3
```

## 开发工具配置

### 1. 代码格式化 (Black)
```bash
# 安装black
pip install black

# 格式化代码
black .

# 检查代码格式
black --check .
```

### 2. 代码检查 (Flake8)
```bash
# 安装flake8
pip install flake8

# 运行代码检查
flake8 .

# 配置文件 .flake8
[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = .git,__pycache__,docs/source/conf.py,old,build,dist
```

### 3. 类型检查 (MyPy)
```bash
# 安装mypy
pip install mypy

# 运行类型检查
mypy .

# 配置文件 mypy.ini
[mypy]
python_version = 3.8
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
```

### 4. 测试配置 (pytest)
```bash
# 创建pytest配置文件 pytest.ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v --cov=core --cov-report=html --cov-report=term-missing
```

## 验证环境

### 1. 创建测试脚本
```python
# test_environment.py
import sys
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

def test_environment():
    """测试开发环境是否正确配置"""
    print("正在测试开发环境...")

    # 测试Python版本
    python_version = sys.version
    print(f"Python版本: {python_version}")

    # 测试主要包
    packages = {
        'pandas': pd.__version__,
        'numpy': np.__version__,
        'matplotlib': plt.__version__
    }

    for package, version in packages.items():
        print(f"{package}: {version}")

    # 测试基本功能
    try:
        df = pd.DataFrame({'A': [1, 2, 3], 'B': [4, 5, 6]})
        print("✓ pandas基本功能正常")

        arr = np.array([1, 2, 3])
        print("✓ numpy基本功能正常")

        plt.plot([1, 2, 3], [1, 4, 2])
        plt.savefig('test_plot.png')
        print("✓ matplotlib基本功能正常")

    except Exception as e:
        print(f"✗ 基本功能测试失败: {e}")
        return False

    print("✓ 环境测试完成！")
    return True

if __name__ == "__main__":
    test_environment()
```

### 2. 运行测试
```bash
# 激活虚拟环境
source venv/bin/activate

# 运行环境测试
python test_environment.py

# 清理测试文件
rm test_plot.png
```

## 常见问题解决

### 1. 依赖包安装失败
```bash
# 升级pip和setuptools
pip install --upgrade pip setuptools wheel

# 使用国内镜像源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple package_name

# 解决编译错误 (Ubuntu)
sudo apt-get install python3-dev build-essential
```

### 2. 数据获取权限问题
```bash
# 申请Tushare token
# 访问 https://tushare.pro/register
# 获取token后配置到config/.env文件中
```

### 3. IDE识别虚拟环境
- VS Code: Command+Shift+P → "Python: Select Interpreter"
- PyCharm: File → Settings → Project → Python Interpreter

### 4. 内存不足
```bash
# 监控内存使用
htop  # Linux
Activity Monitor  # macOS
Task Manager  # Windows

# 优化pandas内存使用
import pandas as pd
pd.set_option('mode.use_inf_as_na', True)
```

## 下一步

环境配置完成后，您可以：

1. 阅读[数据获取指南](04-数据获取.md)
2. 运行第一个数据获取示例
3. 开始开发您的第一个交易策略
4. 探索项目中的notebook示例

## 开发建议

1. **使用虚拟环境**: 始终在虚拟环境中开发
2. **版本控制**: 定期提交代码到Git仓库
3. **代码规范**: 遵循PEP8和项目代码规范
4. **测试驱动**: 先写测试，再写实现
5. **文档更新**: 及时更新相关文档
6. **安全意识**: 不要将敏感信息提交到代码仓库